Server:
  zmq-io-threads: 1
  listen:
    - host: 0.0.0.0
      port: 8000
  status-socket:
    - !zmq.Bind ipc:///tmp/zerogw

Globals:
  error-log:
    level: 5
    warning-timeout: 300

Routing:
  routing: !Suffix ~
  routing-by: !Header Host
  map:
      "*:8000":
        routing: !Prefix ~
        routing-by: !Uri ~
        map:
            "/": # Fallback page
              responses:
                default:
                  headers:
                    Content-Type: text/html; charset="utf-8"
                  body: |
                    <!DOCTYPE html>
                    <meta charset="utf-8" />
                    <title>WebSocket Test</title>
                    <script language="javascript" type="text/javascript">
                      var wsUri = "ws://"+location.host+"/echo";
                      var output;
                      var input;

                      function init() {
                        output = document.getElementById("output");
                        input = document.getElementById("input");
                        testWebSocket();
                        document.getElementById("sendbtn").addEventListener('click',
                            function(ev) {
                                doSend(input.value);
                            }, false);
                      }

                      function testWebSocket() {
                        websocket = new WebSocket(wsUri);
                        websocket.onopen = function(evt) { onOpen(evt) };
                        websocket.onclose = function(evt) { onClose(evt) };
                        websocket.onmessage = function(evt) { onMessage(evt) };
                        websocket.onerror = function(evt) { onError(evt) };
                      }

                      function onOpen(evt) {
                        writeToScreen("CONNECTED");
                        doSend("WebSocket rocks");
                      }

                      function onClose(evt) {
                        writeToScreen("DISCONNECTED");
                      }

                      function onMessage(evt) {
                        writeToScreen('<span style="color: blue;">RESPONSE: ' + evt.data+'</span>');
                      }

                      function onError(evt) {
                        writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data);
                      }

                      function doSend(message) {
                        writeToScreen("SENT: " + message);
                        websocket.send(message);
                      }

                      function writeToScreen(message) {
                        var pre = document.createElement("p");
                        pre.style.wordWrap = "break-word";
                        pre.innerHTML = message;
                        output.appendChild(pre);
                      }

                      window.addEventListener("load", init, false);

                    </script>
                    <h2>WebSocket Test</h2>
                    <input type="text" id="input">
                        <input type="button" id="sendbtn" value="SEND">
                    <div id="output"></div>
                    </html>
            "/echo*":
              timeout: 2
              retry: !RetryFirst
                count: 3
              zmq-forward:
                - !zmq.Bind "tcp://127.0.0.1:7001"
              zmq-contents:
                - !Uri ~
                - !Body ~
              websock:
                forward:
                - !zmq.Bind "tcp://127.0.0.1:7002"
                subscribe:
                - !zmq.Bind "tcp://127.0.0.1:7003"
            "/crossdomain.xml":
              responses:
                default:
                  headers:
                    Content-Type: text/xml; charset="utf-8"
                  body: |
                    <?xml version="1.0"?>
                    <cross-domain-policy>
                        <allow-access-from domain="*" />
                    </cross-domain-policy>
