

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Zerogw Backend Protocols &mdash; Zerogw v0.5.6 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.5.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Zerogw v0.5.6 documentation" href="index.html" />
    <link rel="next" title="Control Socket Protocol" href="control.html" />
    <link rel="prev" title="Installation Guide" href="install.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="control.html" title="Control Socket Protocol"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation Guide"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Zerogw v0.5.6 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="zerogw-backend-protocols">
<h1>Zerogw Backend Protocols<a class="headerlink" href="#zerogw-backend-protocols" title="Permalink to this headline">¶</a></h1>
<div class="section" id="http-forwarding">
<h2>HTTP Forwarding<a class="headerlink" href="#http-forwarding" title="Permalink to this headline">¶</a></h2>
<p>We use zeromq&#8217;s request reply model for http forwarding (except for
<a class="reference internal" href="#long-polling"><em>long polling case</em></a>)</p>
<div class="section" id="request">
<h3>Request<a class="headerlink" href="#request" title="Permalink to this headline">¶</a></h3>
<p>For each http request zerogw forwards a single multipart message.
Request_id is sent like address data (message parts that can be read
using XREP sockets only, and finished by empty message). After address
data configured parts of the request are sent one by one as multipart
message. E.g. if you have following in configuration:</p>
<div class="highlight-python"><pre>zmq-forward:
  contents:
    - !Method
    - !Uri
    - !Header Cookie
    - !Body</pre>
</div>
<p>And you&#8217;ve got request:</p>
<div class="highlight-python"><pre>POST /hello HTTP/1.1
Host: example.com
Cookie: example=cookie_value
Content-Length: 8

PostBody</pre>
</div>
<p>You will receive following message parts (one line per message part):</p>
<div class="highlight-python"><pre>POST
/hello
example=cookie_value
PostBody</pre>
</div>
<p>It&#8217;s up to the application for how to act upon it. Note if you set
<tt class="docutils literal"><span class="pre">retry</span></tt> to something you can get same request twice. And if <tt class="docutils literal"><span class="pre">retry</span></tt>
is set to <tt class="docutils literal"><span class="pre">!RetryFirst</span> <span class="pre">&lt;N&gt;</span></tt> request id will be same for every attempt,
if you&#8217;ve set <tt class="docutils literal"><span class="pre">retry</span></tt> to <tt class="docutils literal"><span class="pre">!RetryLast</span> <span class="pre">&lt;N&gt;</span></tt> request id will change on
each attempt. But usually request id is opaque for user in zeromq.</p>
</div>
<div class="section" id="response">
<h3>Response<a class="headerlink" href="#response" title="Permalink to this headline">¶</a></h3>
<p>Response can contain one, two or three parts for convenience.</p>
<p>In the simple case you just send message body, as a single part message.
Zerogw will respond with <tt class="docutils literal"><span class="pre">200</span> <span class="pre">OK</span></tt> and that message body.</p>
<p>If you respond with two messages first one will be status line, so yo
can respond with 404 page like the following:</p>
<div class="highlight-python"><pre>404 Not Found
&lt;h1&gt; Page Not Found&lt;/h1&gt;</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These ways are quite unuseful in real situations.
<tt class="docutils literal"><span class="pre">Content-Length</span></tt> header will be added automatically, but you should
configure specific <tt class="docutils literal"><span class="pre">Content-Type</span></tt> header in a config to be sure
that browser will render page correctly when using this method</p>
</div>
<p>If you need to supply headers you send 3 message parts. Second one is
constructed from nul-terminated name/value header pairs:</p>
<div class="highlight-python"><pre>200 OK
Content-Type\0text/html\0E-tag\0immortal\0
&lt;b&gt;Lorem ipsum dolor sit amet&lt;/b&gt;</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Last header value must be nul-terminated. You must not add
<tt class="docutils literal"><span class="pre">Content-Length</span></tt> header as it will be generated automatically.
Currently headers sent from backend will be appended to headers
specified in config without overwriting, it can lead to unexpected
behavior on some proxies or browsers so probably use one or another
way for each header type throught the application.</p>
</div>
</div>
</div>
<div class="section" id="websockets-backend-protocol">
<span id="long-polling"></span><h2>WebSockets Backend Protocol<a class="headerlink" href="#websockets-backend-protocol" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Zerogw Backend Protocols</a><ul>
<li><a class="reference internal" href="#http-forwarding">HTTP Forwarding</a><ul>
<li><a class="reference internal" href="#request">Request</a></li>
<li><a class="reference internal" href="#response">Response</a></li>
</ul>
</li>
<li><a class="reference internal" href="#websockets-backend-protocol">WebSockets Backend Protocol</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="install.html"
                        title="previous chapter">Installation Guide</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="control.html"
                        title="next chapter">Control Socket Protocol</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/proto.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="control.html" title="Control Socket Protocol"
             >next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation Guide"
             >previous</a> |</li>
        <li><a href="index.html">Zerogw v0.5.6 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Paul Colomiets.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>